<div class="layout">
  <!-- ============ SIDEBAR ============ -->
  <aside class="sidebar">
    <h3 class="sidebar-title">Paciente</h3>

    <ul class="menu">
      <li class="menu-item active">
        <i class="bi bi-send"></i>
        Solicitudes
      </li>

      <li class="menu-item" routerLink="/portal-paciente">
        <i class="bi bi-house"></i>
        Inicio
      </li>

      <li class="menu-item disabled">
        <i class="bi bi-inbox"></i>
        Solicitudes enviadas
      </li>

      <li class="menu-item disabled">
        <i class="bi bi-clipboard-check"></i>
        Mis solicitudes atención
      </li>

      <li class="menu-item disabled">
        <i class="bi bi-gear"></i>
        Configuración
      </li>

      <li class="menu-item logout" (click)="logout()">
        <i class="bi bi-box-arrow-right"></i>
        Cerrar sesión
      </li>
    </ul>
  </aside>

  <!-- ============ CONTENIDO ============ -->
  <main class="content">
    <header class="header">
      <div>
        <h2>Mis Solicitudes</h2>
        <p>
          Hola, <strong>{{ username }}</strong
          >. Aquí podés gestionar tus solicitudes.
        </p>
      </div>
    </header>

    <section class="grid">
      <!-- ============ FORMULARIO ============ -->
      <article class="card card-form">
        <h3>Enviar solicitud</h3>

        <form [formGroup]="solicitudForm" (ngSubmit)="enviarSolicitud()">
          <!-- Tipo de solicitud -->
          <div class="form-group">
            <label>Tipo de solicitud</label>
            <div class="radio-group">
              <label>
                <input type="radio" value="PRESTADOR" formControlName="tipo" />
                Prestador
              </label>
              <label>
                <input type="radio" value="TRANSPORTISTA" formControlName="tipo" />
                Transportista
              </label>
            </div>
          </div>

          <!-- Buscador + select solo si PRESTADOR -->
          <ng-container *ngIf="solicitudForm.value.tipo === 'PRESTADOR'">
            <div class="form-group">
              <label>Buscar profesional</label>
              <input
                type="text"
                class="form-control"
                placeholder="Filtrar por nombre o especialidad"
                [(ngModel)]="filtroProfesional"
                name="filtroProfesional"
              />
            </div>

            <div class="form-group">
              <label>Profesional / Especialidad</label>
              <select formControlName="idProfesional" class="form-select">
                <option value="" disabled selected>Seleccione uno</option>
                <option *ngFor="let p of profesionalesFiltrados" [value]="p.id">
                  {{ p.nombre }} - {{ p.especialidad }}
                </option>
              </select>
            </div>
          </ng-container>

          <!-- Comentario -->
          <div class="form-group">
            <label>Comentario</label>
            <textarea
              class="form-control"
              rows="3"
              formControlName="comentario"
              placeholder="Ej: necesito sesiones de kinesiología dos veces por semana"
            >
            </textarea>
          </div>

          <button type="submit" class="btn-primary w-100">Enviar solicitud</button>
        </form>
      </article>

      <!-- ============ LISTA DE SOLICITUDES ============ -->
      <article class="card card-list">
        <h3>Solicitudes enviadas</h3>

        <div *ngIf="cargandoSolicitudes" class="alert alert-info">Cargando solicitudes...</div>

        <div *ngIf="!cargandoSolicitudes && solicitudes.length === 0" class="alert alert-empty">
          Aún no enviaste ninguna solicitud.
        </div>

        <div *ngIf="solicitudes.length > 0" class="table-wrapper">
          <table class="table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Especialidad</th>
                <th>Estado</th>
                <th>Fecha</th>
                <th>Acciones</th>
              </tr>
            </thead>

            <tbody>
              <tr *ngFor="let s of solicitudes">
                <td>#{{ s.id }}</td>
                <td>{{ s.especialidad }}</td>

                <td>
                  <span
                    class="badge"
                    [ngClass]="{
                      'badge-pendiente': s.estado === 'PENDIENTE',
                      'badge-aceptado': s.estado === 'ACEPTADO',
                      'badge-rechazado': s.estado === 'RECHAZADO',
                      'badge-cancelado': s.estado === 'CANCELADO'
                    }"
                  >
                    {{ s.estado }}
                  </span>
                </td>

                <td>{{ s.fechaSolicitud | date : 'short' }}</td>

                <td>
                  <button
                    class="btn-outline btn-sm"
                    *ngIf="s.estado === 'PENDIENTE'"
                    (click)="cancelarSolicitud(s)"
                  >
                    Cancelar
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </article>
    </section>
  </main>
</div>
